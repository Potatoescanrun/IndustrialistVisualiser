<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Grid Builder</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      overflow: hidden;
      font-family: sans-serif;
    }
    #sidebar {
      position: fixed;
      left: 0; top: 0; bottom: 60px;
      width: 200px;
      overflow-y: auto;
      background: #ddd;
      border-right: 2px solid #aaa;
      padding: 10px;
    }
    .item {
      background: #fff;
      margin-bottom: 10px;
      padding: 5px;
      border: 1px solid #aaa;
      cursor: pointer;
    }
    .item img {
      width: 100%; height: auto;
    }
    canvas {
      position: fixed;
      left: 200px; top: 0; right: 0; bottom: 60px;
      background: #f0f0f0;
      display: block;
    }
    #toolbar {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      height: 60px;
      background: #333;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
    }
    .mode-btn {
      margin: 0 10px;
      padding: 10px 20px;
      background: #555;
      border: none;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
    .mode-btn.active {
      background: #1e90ff;
    }
    #totalCost {
      position: fixed;
      bottom: 10px;
      right: 10px;
      font-size: 18px;
      background: white;
      padding: 6px 12px;
      border-radius: 8px;
      box-shadow: 0 0 5px #0003;
    }
  </style>
</head>
<body>
<div id="sidebar">
  <div class="item" data-name="Solar Panel" data-price="50">
    <img src="https://via.placeholder.com/150x80?text=Solar+Panel">
    <div><strong>Solar Panel</strong><br>$50</div>
  </div>
  <div class="item" data-name="Battery" data-price="100">
    <img src="https://via.placeholder.com/150x80?text=Battery">
    <div><strong>Battery</strong><br>$100</div>
  </div>
</div>

<canvas id="gridCanvas"></canvas>

<div id="toolbar">
  <button class="mode-btn" data-mode="build">1 Build</button>
  <button class="mode-btn" data-mode="wire">2 Wire</button>
  <button class="mode-btn" data-mode="pipe">3 Pipe</button>
  <button class="mode-btn" data-mode="delete">4 Delete</button>
</div>

<div id="totalCost">Total: $0</div>

<script>
const canvas = document.getElementById("gridCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth - 200;
canvas.height = window.innerHeight - 60;

let offsetX = 0, offsetY = 0;
let zoom = 1;
let isDragging = false;
let lastX, lastY;
let placedItems = [];
let currentItem = null;
let currentMode = "build";
let totalCost = 0;

function drawGrid() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.save();
  ctx.translate(offsetX, offsetY);
  ctx.scale(zoom, zoom);

  const gridSize = 50;
  const cols = canvas.width / zoom / gridSize + 2;
  const rows = canvas.height / zoom / gridSize + 2;
  const startX = -offsetX / zoom - 1;
  const startY = -offsetY / zoom - 1;

  ctx.strokeStyle = "#ccc";
  for (let x = Math.floor(startX / gridSize) * gridSize; x < startX + cols * gridSize; x += gridSize) {
    ctx.beginPath();
    ctx.moveTo(x, startY);
    ctx.lineTo(x, startY + rows * gridSize);
    ctx.stroke();
  }

  for (let y = Math.floor(startY / gridSize) * gridSize; y < startY + rows * gridSize; y += gridSize) {
    ctx.beginPath();
    ctx.moveTo(startX, y);
    ctx.lineTo(startX + cols * gridSize, y);
    ctx.stroke();
  }

  for (let item of placedItems) {
    ctx.fillStyle = "orange";
    ctx.fillRect(item.x * gridSize, item.y * gridSize, gridSize, gridSize);
    ctx.fillStyle = "black";
    ctx.fillText(item.name, item.x * gridSize + 5, item.y * gridSize + 20);
  }

  ctx.restore();
}

canvas.addEventListener("mousedown", e => {
  isDragging = true;
  lastX = e.clientX;
  lastY = e.clientY;
});
canvas.addEventListener("mouseup", () => isDragging = false);
canvas.addEventListener("mouseleave", () => isDragging = false);
canvas.addEventListener("mousemove", e => {
  if (isDragging) {
    offsetX += e.clientX - lastX;
    offsetY += e.clientY - lastY;
    lastX = e.clientX;
    lastY = e.clientY;
    drawGrid();
  }
});

canvas.addEventListener("wheel", e => {
  e.preventDefault();
  const zoomFactor = 1.1;
  const mouseX = e.clientX - 200;
  const mouseY = e.clientY;
  const wheel = e.deltaY < 0 ? 1 : -1;
  const zoomAmount = wheel > 0 ? zoomFactor : 1 / zoomFactor;
  const worldX = (mouseX - offsetX) / zoom;
  const worldY = (mouseY - offsetY) / zoom;
  zoom *= zoomAmount;
  offsetX = mouseX - worldX * zoom;
  offsetY = mouseY - worldY * zoom;
  drawGrid();
});

canvas.addEventListener("click", e => {
  if (currentMode !== "build" || !currentItem) return;
  const mouseX = e.clientX - 200;
  const mouseY = e.clientY;
  const worldX = Math.floor((mouseX - offsetX) / (50 * zoom));
  const worldY = Math.floor((mouseY - offsetY) / (50 * zoom));
  placedItems.push({ x: worldX, y: worldY, name: currentItem.name, price: currentItem.price });
  totalCost += currentItem.price;
  document.getElementById("totalCost").textContent = `Total: $${totalCost}`;
  drawGrid();
});

document.querySelectorAll(".item").forEach(item => {
  item.addEventListener("click", () => {
    currentItem = {
      name: item.dataset.name,
      price: parseInt(item.dataset.price),
    };
  });
});

document.querySelectorAll(".mode-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    currentMode = btn.dataset.mode;
    document.querySelectorAll(".mode-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
  });
});

document.addEventListener("keydown", e => {
  if (e.key >= "1" && e.key <= "4") {
    const modes = ["build", "wire", "pipe", "delete"];
    currentMode = modes[parseInt(e.key) - 1];
    document.querySelectorAll(".mode-btn").forEach(b => {
      b.classList.toggle("active", b.dataset.mode === currentMode);
    });
  }
});

window.addEventListener("resize", () => {
  canvas.width = window.innerWidth - 200;
  canvas.height = window.innerHeight - 60;
  drawGrid();
});

drawGrid();
</script>
</body>
</html>
